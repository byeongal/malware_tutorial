import os
import pefile

# AhnLab-V3 : Undetected
# ALYac : Undetected
# AD73.exe
# AhnLab-V3 : Undetected
# ALYac : AIT:Trojan.Nymeria.219
# COM Surrogate.exe
# AhnLab-V3 : Undetected
# ALYac : Generic.MSIL.PasswordStealerA.134DA4DD
# GoogleVssAgent.exe
# AhnLab-V3 : Undetected
# ALYac : Generic.MSIL.PasswordStealerA.8D9D233E

file_path = r"./samples/faee802f30ff0815d8e4ad640d9e5bfd.vir"

pe = pefile.PE(file_path)
overlay_offset = pe.get_overlay_data_start_offset()
if overlay_offset:
    print('Size :', os.path.getsize(file_path) - overlay_offset)
    print('file-ratio : {:.2f} %'.format(os.path.getsize(file_path) - overlay_offset) / os.path.getsize(file_path))
    overlay_data = pe.get_overlay()
    hex_overlay_data = [format(i, '02X') for i in overlay_data[:16]]
    print('first-bytes-hex : {}'.format(' '.join(hex_overlay_data[:16])))
    print('first-bytes-text : {}'.format(str(overlay_data[:16])))

with open('./samples/overlay.zip', 'wb') as f:
    f.write(pe.get_overlay())