import pefile
import ordlookup

# AhnLab-V3 : Trojan/Win32.FileCoder.C3039218
# ALYac : Generic.Ransom.GandCrab5.67F509E5
file_path = r"./samples/91c386199f9c2d9cc116e5a32b90b44f.vir"
pe = pefile.PE(file_path)

libname = pe.DIRECTORY_ENTRY_EXPORT.name
if isinstance(libname, bytes):
    libname = libname.decode().lower()
else:
    libname = libname.dll.lower()

print(libname)
for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols:
    if not exp.name:
        funcname = ordlookup.ordLookup(libname, exp.ordinal, make_name=True)
        if not funcname:
            raise Exception("Unable to look up ordinal %s:%04x" % (libname, exp.ordinal))
    else:
        funcname = exp.name
    if not funcname:
        continue
    if not funcname:
        continue
    if isinstance(funcname, bytes):
        funcname = funcname.decode()
    print('Address : 0x{:08X}\tName : {}\tOrdinal : {}'.format(exp.address, funcname, exp.ordinal))